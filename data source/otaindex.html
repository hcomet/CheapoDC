<!DOCTYPE html>
<html>
<head><title>Device Management</title> <link rel="icon" type="image/png" href="/favicon.png">
   <link rel="stylesheet" href="./CDCStyle.css">
   <style>
      .configline {
         grid-template-columns: 2fr 3fr 1fr;
         grid-template-areas: "configItem  configValue configAction"; 
         border: none;
      }
      h3 {
         margin-top: 10px;
         margin-bottom: 2px;
      }
   </style>
</head><body>
   <div id="loader"></div>
   <div class="wrapper">
   <header><div class="headerGrid">
      <hIcon class="logo"><img src="/cheapo.png" alt="CheapoDC" onclick="window.location.href='https://github.com/hcomet/CheapoDC'"></hIcon>
      <hTitle class="title">Device Management</hTitle>
      <logoutIcon onclick="logoutCDC()"><img src="/logout.png" alt="Logout"></logoutIcon>
  </div>
  </header>
   <main>
      <h2>Controller Pin Configuration</h2>
      <h3>Controller Pin 0</h3>
      <div class="configline">
         <configItem>GPIO:</configItem><configValue><div class="cReading"><input type="number" name="CPP0" step="1" min="-1" max="39" class="cInput"
            id="CPP0I" data-cdc="%CPP0%" /></div></configValue>
            <configAction><button type="button" class="cButton" id="CPP0" disabled>Update</button></configAction>
      </div>
      <div class="configline">
         <configItem>Pin Mode:</configItem><configValue><div class="cReading"><select name="CPM0" id="CPM0S" data-cdc="%CPM0%">
            <option id="Disabled" value="0">Disabled</option>
            <option id="Controller" value="1">Controller</option>
            </select>
            </div></configValue>
            <configAction><button type="button" class="cButton" id="CPM0" disabled>Update</button></configAction>
      </div>
      <div class="configline">
         <configItem>Output:</configItem><configValue><div class="cReading"><input type="number" name="CPO0" disabled class="cInput"
            id="CPO0I" data-cdc="%CPO0%" /></div></configValue>
            <configAction><button type="button fn" class="cButton hidden" id="CPO0" disabled>Update</button></configAction>
      </div>
      <h3>Controller Pin 1</h3>
      <div class="configline">
         <configItem>GPIO:</configItem><configValue><div class="cReading"><input type="number" name="CPP1" step="1" min="-1" max="39" class="cInput"
            id="CPP1I" data-cdc="%CPP1%" /></div></configValue>
            <configAction><button type="button" class="cButton" id="CPP1" disabled>Update</button></configAction>
      </div>
      <div class="configline">
         <configItem>Pin Mode:</configItem><configValue><div class="cReading"><select name="CPM1" id="CPM1S" data-cdc="%CPM1%">
            <option id="Disabled" value="0">Disabled</option>
            <option id="Controller" value="1">Controller</option>
            </select>
            </div></configValue>
            <configAction><button type="button" class="cButton" id="CPM1" disabled>Update</button></configAction>
      </div>
      <div class="configline">
         <configItem>Output:</configItem><configValue><div class="cReading"><input type="number" disabled class="cInput"
            id="CPO1I" data-cdc="%CPO1%" /></div></configValue>
            <configAction><button type="button fn" class="cButton hidden" id="CPO1" disabled>Update</button></configAction>
      </div>
      <h3>Controller Pin 2</h3>
      <div class="configline">
         <configItem>GPIO:</configItem><configValue><div class="cReading"><input type="number" name="CPP2" step="1" min="-1" max="39" class="cInput"
            id="CPP2I" data-cdc="%CPP2%" /></div></configValue>
            <configAction><button type="button" class="cButton" id="CPP2" disabled>Update</button></configAction>
      </div>
      <div class="configline">
         <configItem>Pin Mode:</configItem><configValue><div class="cReading"><select name="CPM2" id="CPM2S" data-cdc="%CPM2%">
            <option id="Disabled" value="0">Disabled</option>
            <option id="Controller" value="1">Controller</option>
            <option id="PWM" value="2">PWM</option>
            <option id="Boolean" value="3">Boolean</option>
            </select>
            </div></configValue>
            <configAction><button type="button" class="cButton" id="CPM2" disabled>Update</button></configAction>
      </div>
      <div class="configline">
         <configItem>Output:</configItem><configValue><div class="cReading"><input type="number" name="CPO2" step="1" min="0" max="100" class="cInput"
            id="CPO2I" data-cdc="%CPO2%" /></div></configValue>
            <configAction><button type="button fn" class="cButton" id="CPO2" disabled>Update</button></configAction>
      </div>
      <h3>Controller Pin 3</h3>
      <div class="configline">
         <configItem>GPIO:</configItem><configValue><div class="cReading"><input type="number" name="CPP3" step="1" min="-1" max="39" class="cInput"
            id="CPP3I" data-cdc="%CPP3%" /></div></configValue>
            <configAction><button type="button" class="cButton" id="CPP3" disabled>Update</button></configAction>
      </div>
      <div class="configline">
         <configItem>Pin Mode:</configItem><configValue><div class="cReading"><select name="CPM3" id="CPM3S" data-cdc="%CPM3%">
            <option id="Disabled" value="0">Disabled</option>
            <option id="Controller" value="1">Controller</option>
            <option id="PWM" value="2">PWM</option>
            <option id="Boolean" value="3">Boolean</option>
            </select>
            </div></configValue>
            <configAction><button type="button" class="cButton" id="CPM3" disabled>Update</button></configAction>
      </div>
      <div class="configline">
         <configItem>Output:</configItem><configValue><div class="cReading"><input type="number" name="CPO3" step="1" min="0" max="100" class="cInput"
            id="CPO3I" data-cdc="%CPO3%" /></div></configValue>
            <configAction><button type="button" class="cButton" id="CPO3" disabled>Update</button></configAction>
      </div>
      <h3>Controller Pin 4</h3>
      <div class="configline">
         <configItem>GPIO:</configItem><configValue><div class="cReading"><input type="number" name="CPP4" step="1" min="-1" max="39" class="cInput"
            id="CPP4I" data-cdc="%CPP4%" /></div></configValue>
            <configAction><button type="button" class="cButton" id="CPP4" disabled>Update</button></configAction>
      </div>
      <div class="configline">
         <configItem>Pin Mode:</configItem><configValue><div class="cReading"><select name="CPM4" id="CPM4S" data-cdc="%CPM4%">
            <option id="Disabled" value="0">Disabled</option>
            <option id="Controller" value="1">Controller</option>
            <option id="PWM" value="2">PWM</option>
            <option id="Boolean" value="3">Boolean</option>
            </select>
            </div></configValue>
            <configAction><button type="button" class="cButton" id="CPM4" disabled>Update</button></configAction>
      </div>
      <div class="configline">
         <configItem>Output:</configItem><configValue><div class="cReading"><input type="number" name="CPO4" step="1" min="0" max="100" class="cInput"
            id="CPO4I" data-cdc="%CPO4%" /></div></configValue>
            <configAction><button type="button" class="cButton" id="CPO4" disabled>Update</button></configAction>
      </div>
      <h3>Controller Pin 5</h3>
      <div class="configline">
         <configItem>GPIO:</configItem><configValue><div class="cReading"><input type="number" name="CPP5" step="1" min="-1" max="39" class="cInput"
            id="CPP5I" data-cdc="%CPP5%" /></div></configValue>
            <configAction><button type="button" class="cButton" id="CPP5" disabled>Update</button></configAction>
      </div>
      <div class="configline">
         <configItem>Pin Mode:</configItem><configValue><div class="cReading"><select name="CPM5" id="CPM5S" data-cdc="%CPM5%">
            <option id="Disabled" value="0">Disabled</option>
            <option id="Controller" value="1">Controller</option>
            <option id="PWM" value="2">PWM</option>
            <option id="Boolean" value="3">Boolean</option>
            </select>
            </div></configValue>
            <configAction><button type="button" class="cButton" id="CPM5" disabled>Update</button></configAction>
      </div>
      <div class="configline">
         <configItem>Output:</configItem><configValue><div class="cReading"><input type="number" name="CPO5" step="1" min="0" max="100" class="cInput"
            id="CPO5I" data-cdc="%CPO5%" /></div></configValue>
            <configAction><button type="button" class="cButton" id="CPO5" disabled>Update</button></configAction>
      </div>
      <hr class="footerThr">
   <h2>Web OTA Firmware Update</h2>
   <form id="uploadForm" method="POST" action="/upload" enctype="multipart/form-data">
      <input type="file" name="file1" id="file1" value="Choose FW" /><input type="button" name="upload"  id="iupload" value="Update" title="Upload File" onclick="uploadFile()" disabled/>
      <h3 id="status">Completed: 0&percnt;</h3> <p id="loaded_n_total"><span id="filename"></span><span id="filesize"></span></p>
  </form> 
  <hr class="footerThr">
  <h2>Reboot Device</h2>
  <button type="button" class="reboot" onclick="rebootDevice()">Reboot</button>
</main>
<aside>
   <div class="locName">%LNM%</div><div class="locCoord">%LAT%, %LON%</div><div class="queryLocName">%WUL%</div>
   <div class="weatherIcon"><img src="%WICON%"></div><div class="weatherDesc">%WDESC%</div>
   <div class="wReading"><wReadingTerm>Temperature:</wReadingTerm><wReadingValue>%ATPQ%</wReadingValue></div>
   <div class="wReading"><wReadingTerm>Dew Point:</wReadingTerm><wReadingValue>%DP%</wReadingValue></div>
   <div class="wReading"><wReadingTerm>Humidity:</wReadingTerm><wReadingValue>%HU%</wReadingValue></div>
</aside>
<footer>
   <hr class="footerThr">
<button type="button" class="bfooter" onclick="document.location='../dashboard'" >Dashboard</button>  
<button type="button" class="bfooter" onclick="document.location='../config'">Configuration</button>
<button type="button" class="bfooterDisabled" disable>Device Management</button> <!-- onclick="document.location='../otaIndex'"-->
<button type="button" class="bfooter" onclick="document.location='../listFiles'" >File Management</button> 
<hr class="footerBhr">
<div class="atribution">Cheapo Dew Controller - &copy; 2025 - Release: %FW% <br />(Heap: %HP%, File space: %LFS%)</div>
</footer></div>
<script>
   document.getElementById('file1').addEventListener('change', function() {document.getElementById('iupload').disabled = false;  });
 function uploadFile() {
  var file = document.getElementById("file1").files[0];
  document.getElementById("filename").innerHTML =  document.getElementById("file1").value.replace(/.*[\/\\]/, '') + ": ";
  var formdata = new FormData();
  formdata.append("file1", file);
  var ajax = new XMLHttpRequest();
  ajax.upload.addEventListener("progress", progressHandler, false);
  ajax.open("POST", "/update");
  ajax.send(formdata);
}
function progressHandler(event) {
  document.getElementById("filesize").innerHTML =  event.loaded + " bytes";
  var percent = (event.loaded / event.total) * 100;
  document.getElementById("status").innerHTML = "Completed: " + Math.round(percent) + "&percnt;";
  if (percent >= 100) {
      document.getElementById("status").innerHTML = "Completed: 100&percnt; Wait for Reload."; 
      document.getElementById("iupload").disabled = true;
      setTimeout(function() {location.reload();}, 5000);
      //document.getElementById("file1").addEventListener('change', function() {
        //       document.getElementById('iupload').disabled = false;
         //      document.getElementById("status").innerHTML = "Completed: 0&percnt;";});
  }
}
function rebootDevice() {
    if (confirm("Confirm Reboot")) {
        xmlhttp = new XMLHttpRequest();
        xmlhttp.open("GET", "/reboot", true);
        xmlhttp.send();
    }
}
function logoutCDC() {
  var xhr = new XMLHttpRequest();
  xhr.open("GET", "/logout", true);
  xhr.send();
  setTimeout(function(){ window.open("/dashboard","_self"); }, 1000);
}
 </script>
 <script src="CDCjs.js"></script></body>
</html>