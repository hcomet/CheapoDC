var MD5,refreshCount=0;function onLoad(e){document.getElementById("loader")&&(document.getElementById("loader").style.display="block",initButtons()),document.addEventListener("keydown",function(e){e.ctrlKey&&"z"===e.key&&initButtons()})}function convertHTML(e){"use strict";const t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&apos;":"'","&deg;":"\u00B0","&percnt;":"%","&commat;":"@"};let n=e,o=e;for(const e in t)o.indexOf(e)>=0&&(n=o.replaceAll(e,t[e]),o=n);return n}function encodeForHTTP(e){"use strict";const t={"%":"%25","&":"%26","<":"%3C",">":"%3E","?":"%3F","@":"%40",$:"%24","+":"%2B","#":"%23"};let n=e,o=e;for(const e in t)o.indexOf(e)>=0&&(n=o.replaceAll(e,t[e]),o=n);return n}function removeUnits(e){"use strict";const t={0:"\u00B0",1:"%",2:"min",3:"msec",4:"sec",5:"&"};let n=e;for(let o=0;o<=5;o++){let d=e.indexOf(t[o]);d>=0&&(n=e.substr(0,d),o=6)}return n}function setValue(e){var t=e.id,n=new XMLHttpRequest;n.open("POST","/getvalue",!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.responseType="json",n.onreadystatechange=()=>{if(n.readyState===XMLHttpRequest.DONE&&200===n.status){var e=n.response,t=Object.keys(e)[0],o=t+"I",d=t+"S",a=Object.values(e)[0];document.getElementById(o)?"number"==document.getElementById(o).type?document.getElementById(o).dataset.cdc=a:document.getElementById(o).dataset.cdc=convertHTML(a):document.getElementById(d)?document.getElementById(d).dataset.cdc=a:console.log("No Input or Select found for: "+t),(refreshCount-=1)<=0&&(refreshCount=0,initButtons())}},n.send("get="+t),refreshCount+=1}function refreshData(){[...document.getElementsByClassName("cbtn")].forEach(function(e){setValue(e)})}function sendValue(e){var t,n=e+"I",o=e+"S";if(document.getElementById("loader").style.display="block",document.getElementById(n))t=document.getElementById(n).value;else{if(!document.getElementById(o))return void console.log("No Input or Select found for: "+e);t=document.getElementById(o).value}"SDAP"!=e&&"SCLP"!=e||(document.getElementById("i2cMessage").innerHTML="<strong>Important:</strong> Reboot required before changes will take effect.");var d=new XMLHttpRequest;d.open("POST","/setvalue",!0),d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d.responseType="json",d.onreadystatechange=()=>{d.readyState===XMLHttpRequest.DONE&&200===d.status&&refreshData()},d.send(e+"="+encodeForHTTP(t)),document.getElementById(e).disabled=!0}function setChangeItem(e){var t=e.id,n=t+"I",o=t+"S";if(e.disabled=!0,document.getElementById(n)){let e=document.getElementById(n);switch(e.oninput=e=>{document.getElementById(t).disabled=!1,document.getElementById(t).onclick=function(){sendValue(t)}},e.type){case"number":e.value=removeUnits(e.dataset.cdc);break;case"text":case"url":e.value=e.dataset.cdc;break;default:console.log("Bad input type: "+e.type)}}else{if(!document.getElementById(o))return void console.log("No Input or Select found for: "+t);{let e=document.getElementById(o);switch(e.onchange=e=>{document.getElementById(t).disabled=!1,document.getElementById(t).onclick=function(){sendValue(t)}},e.dataset.cdc){case"Automatic":case"Weather Source":case"Dew Point":case"Open-Meteo":case"Disabled":case"0":e.value=0;break;case"Manual":case"External Input":case"Temperature":case"OpenWeather":case"Controller":case"1":e.value=1;break;case"Off":case"Midpoint":case"External Source":case"PWM":case"2":e.value=2;break;case"Internal Source":case"Boolean":case"3":e.value=3;break;default:console.log("Bad Select value: "+e.dataset.cdc)}}}switch(t){case"DCM":1==document.getElementById("DCMS").value?(document.getElementById("DCO").className="cbtn",document.getElementById("DCOI").disabled=!1):(document.getElementById("DCO").className="cbtn hidden",document.getElementById("DCOI").disabled=!0);break;case"OMIN":let e=parseInt(document.getElementById("OMINI").value);document.getElementById("DCOI").setAttribute("min",e),document.getElementById("OMAXI").setAttribute("min",e+1);break;case"OMAX":let d=parseInt(document.getElementById("OMAXI").value);document.getElementById("DCOI").setAttribute("max",d),document.getElementById("OMINI").setAttribute("max",d-1);break;case"WS":2==document.getElementById("WSS").value?(document.getElementById("ATPQ").className="cbtn",document.getElementById("ATPQI").disabled=!1,document.getElementById("HU").className="cbtn",document.getElementById("HUI").disabled=!1):(document.getElementById("ATPQ").className="cbtn hidden",document.getElementById("ATPQI").disabled=!0,document.getElementById("HU").className="cbtn hidden",document.getElementById("HUI").disabled=!0);break;case"CPP0":case"CPP1":case"CPP2":case"CPP3":case"CPP4":case"CPP5":{let e=t.substr(3,1);-1==document.getElementById(n).value?(document.getElementById("CPM"+e).className="cbtn hidden",document.getElementById("CPM"+e+"S").disabled=!0):(document.getElementById("CPM"+e).className="cbtn",document.getElementById("CPM"+e+"S").disabled=!1);break}case"CPM0":case"CPM1":case"CPM2":case"CPM3":case"CPM4":case"CPM5":{let e=t.substr(3,1);switch(document.getElementById(o).value){case"0":case"1":document.getElementById("CPO"+e).className="cbtn hidden",document.getElementById("CPO"+e+"I").disabled=!0;break;case"2":document.getElementById("CPO"+e).className="cbtn",document.getElementById("CPO"+e+"I").disabled=!1,document.getElementById("CPO"+e+"I").setAttribute("step",1);break;case"3":document.getElementById("CPO"+e).className="cbtn",document.getElementById("CPO"+e+"I").disabled=!1,document.getElementById("CPO"+e+"I").setAttribute("step",100)}break}}}function initButtons(){[...document.getElementsByClassName("cbtn")].forEach(function(e){setChangeItem(e)}),document.getElementById("loader").style.display="none"}function logoutCDC(){var e=new XMLHttpRequest;e.open("GET","/logout",!0),e.send(),setTimeout(function(){window.open("/dashboard","_self")},1e3)}function httpOTAAvailability(e){"NOSUPPORT"==e?(document.getElementById("fwUpdateNotAvailable").style.display="block",document.getElementById("fwUpdateNotAvailable").innerHTML="Not supported.",document.getElementById("fwUpdateAvailable").style.display="none",document.getElementById("readfota").style.display="none"):"NOFWUPDATE"!=e?(document.getElementById("fwUpdateAvailable").style.display="block",document.getElementById("fwUpdateNotAvailable").style.display="none"):(document.getElementById("fwUpdateNotAvailable").style.display="block",document.getElementById("fwUpdateNotAvailable").innerHTML="No update available. Currently at latest version.",document.getElementById("fwUpdateAvailable").style.display="none")}function updateOTAError(e){let t=document.getElementById("otaerror");console.log("OTA update error: "+e),t.style.display=""==e?"hidden":"block",t.innerHTML=e}function httpOTAUpload(){var e=MD5.generate("admin:CheapoDC:"+document.getElementById("HTTPOTAPWD").value),t=new XMLHttpRequest,n=new EventSource("/events");window.EventSource?(n.addEventListener("open",e=>{document.getElementById("status").innerHTML="HTTP OTA Connected."}),n.addEventListener("status",e=>{document.getElementById("filename").innerHTML=e.data}),n.addEventListener("error",e=>{e.target.readyState!=EventSource.OPEN?updateOTAError("Events Disconnected"):updateOTAError(e.data)}),n.addEventListener("message",e=>{document.getElementById("status").innerHTML=e.data}),n.addEventListener("progress",e=>{httpOTAProgress(e.data)}),n.addEventListener("reboot",e=>{otaReboot(e.data)})):console.log("something is broken"),t.open("POST","/updatehtml",!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send("password="+encodeForHTTP(e))}function httpOTAProgress(e){document.getElementById("filesize").innerHTML=e>0?" "+e+"&percnt; ":" "}function otaReboot(e){"Refresh"==e&&setTimeout(function(){location.reload()},5e3)}function fileOTAUpload(){var e=document.getElementById("file1").files[0];document.getElementById("filename").innerHTML=document.getElementById("file1").value.replace(/.*[\/\\]/,"")+": ";var t=new FormData;t.append("method","file"),t.append("file1",e);var n=new XMLHttpRequest;n.upload.addEventListener("progress",progressHandler,!1),n.open("POST","/update"),n.send(t)}function progressHandler(e){document.getElementById("filesize").innerHTML=e.loaded+" bytes";var t=e.loaded/e.total*100;document.getElementById("status").innerHTML="Completed: "+Math.round(t)+"&percnt;",t>=100&&(document.getElementById("status").innerHTML="Completed: 100&percnt; Wait for Reload.",document.getElementById("iupload").disabled=!0,setTimeout(function(){location.reload()},5e3))}function rebootDevice(){if(confirm("Confirm Reboot")){let e=new XMLHttpRequest;e.open("GET","/reboot",!0),e.send()}}function checkPasswordUpdate(){""!=document.getElementById("newpassword").value&&document.getElementById("newpassword").value==document.getElementById("confpassword").value&&""!=document.getElementById("oldpassword").value?document.getElementById("passwordButton").disabled=!1:document.getElementById("passwordButton").disabled=!0}function changePassword(){var e=MD5.generate("admin:CheapoDC:"+document.getElementById("newpassword").value),t=MD5.generate("admin:CheapoDC:"+document.getElementById("oldpassword").value);if(e!=MD5.generate("admin:CheapoDC:"+document.getElementById("confpassword").value))return alert("New Passwords do not match"),void(document.getElementById("passwordButton").disabled=!0);var n=new XMLHttpRequest;document.getElementById("loader").style.display="block",n.open("POST","/setpassword",!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send("newpassword="+encodeForHTTP(e)+"&oldpassword="+encodeForHTTP(t)),setTimeout(function(){location.reload()},1e3)}(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{e.r(t),e.d(t,{MD5:()=>u,generate:()=>o});var n=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var o=e.charCodeAt(n);o<128?t+=String.fromCharCode(o):o>127&&o<2048?(t+=String.fromCharCode(o>>6|192),t+=String.fromCharCode(63&o|128)):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128),t+=String.fromCharCode(63&o|128))}return t};function o(e){var t,o,d,u,m,f,g,y,p,I;for(t=function(e){for(var t,n=e.length,o=n+8,d=16*((o-o%64)/64+1),a=Array(d-1),s=0,l=0;l<n;)s=l%4*8,a[t=(l-l%4)/4]=a[t]|e.charCodeAt(l)<<s,l++;return s=l%4*8,a[t=(l-l%4)/4]=a[t]|128<<s,a[d-2]=n<<3,a[d-1]=n>>>29,a}(n(e)),g=1732584193,y=4023233417,p=2562383102,I=271733878,o=0;o<t.length;o+=16)d=g,u=y,m=p,f=I,g=s(g,y,p,I,t[o+0],7,3614090360),I=s(I,g,y,p,t[o+1],12,3905402710),p=s(p,I,g,y,t[o+2],17,606105819),y=s(y,p,I,g,t[o+3],22,3250441966),g=s(g,y,p,I,t[o+4],7,4118548399),I=s(I,g,y,p,t[o+5],12,1200080426),p=s(p,I,g,y,t[o+6],17,2821735955),y=s(y,p,I,g,t[o+7],22,4249261313),g=s(g,y,p,I,t[o+8],7,1770035416),I=s(I,g,y,p,t[o+9],12,2336552879),p=s(p,I,g,y,t[o+10],17,4294925233),y=s(y,p,I,g,t[o+11],22,2304563134),g=s(g,y,p,I,t[o+12],7,1804603682),I=s(I,g,y,p,t[o+13],12,4254626195),p=s(p,I,g,y,t[o+14],17,2792965006),g=l(g,y=s(y,p,I,g,t[o+15],22,1236535329),p,I,t[o+1],5,4129170786),I=l(I,g,y,p,t[o+6],9,3225465664),p=l(p,I,g,y,t[o+11],14,643717713),y=l(y,p,I,g,t[o+0],20,3921069994),g=l(g,y,p,I,t[o+5],5,3593408605),I=l(I,g,y,p,t[o+10],9,38016083),p=l(p,I,g,y,t[o+15],14,3634488961),y=l(y,p,I,g,t[o+4],20,3889429448),g=l(g,y,p,I,t[o+9],5,568446438),I=l(I,g,y,p,t[o+14],9,3275163606),p=l(p,I,g,y,t[o+3],14,4107603335),y=l(y,p,I,g,t[o+8],20,1163531501),g=l(g,y,p,I,t[o+13],5,2850285829),I=l(I,g,y,p,t[o+2],9,4243563512),p=l(p,I,g,y,t[o+7],14,1735328473),g=i(g,y=l(y,p,I,g,t[o+12],20,2368359562),p,I,t[o+5],4,4294588738),I=i(I,g,y,p,t[o+8],11,2272392833),p=i(p,I,g,y,t[o+11],16,1839030562),y=i(y,p,I,g,t[o+14],23,4259657740),g=i(g,y,p,I,t[o+1],4,2763975236),I=i(I,g,y,p,t[o+4],11,1272893353),p=i(p,I,g,y,t[o+7],16,4139469664),y=i(y,p,I,g,t[o+10],23,3200236656),g=i(g,y,p,I,t[o+13],4,681279174),I=i(I,g,y,p,t[o+0],11,3936430074),p=i(p,I,g,y,t[o+3],16,3572445317),y=i(y,p,I,g,t[o+6],23,76029189),g=i(g,y,p,I,t[o+9],4,3654602809),I=i(I,g,y,p,t[o+12],11,3873151461),p=i(p,I,g,y,t[o+15],16,530742520),g=r(g,y=i(y,p,I,g,t[o+2],23,3299628645),p,I,t[o+0],6,4096336452),I=r(I,g,y,p,t[o+7],10,1126891415),p=r(p,I,g,y,t[o+14],15,2878612391),y=r(y,p,I,g,t[o+5],21,4237533241),g=r(g,y,p,I,t[o+12],6,1700485571),I=r(I,g,y,p,t[o+3],10,2399980690),p=r(p,I,g,y,t[o+10],15,4293915773),y=r(y,p,I,g,t[o+1],21,2240044497),g=r(g,y,p,I,t[o+8],6,1873313359),I=r(I,g,y,p,t[o+15],10,4264355552),p=r(p,I,g,y,t[o+6],15,2734768916),y=r(y,p,I,g,t[o+13],21,1309151649),g=r(g,y,p,I,t[o+4],6,4149444226),I=r(I,g,y,p,t[o+11],10,3174756917),p=r(p,I,g,y,t[o+2],15,718787259),y=r(y,p,I,g,t[o+9],21,3951481745),g=a(g,d),y=a(y,u),p=a(p,m),I=a(I,f);return c(g)+c(y)+c(p)+c(I)}function d(e,t){return e<<t|e>>>32-t}function a(e,t){var n,o,d,a,s;return d=2147483648&e,a=2147483648&t,s=(1073741823&e)+(1073741823&t),(n=1073741824&e)&(o=1073741824&t)?2147483648^s^d^a:n|o?1073741824&s?3221225472^s^d^a:1073741824^s^d^a:s^d^a}function s(e,t,n,o,s,l,i){return e=a(e,a(a(function(e,t,n){return e&t|~e&n}(t,n,o),s),i)),a(d(e,l),t)}function l(e,t,n,o,s,l,i){return e=a(e,a(a(function(e,t,n){return e&n|t&~n}(t,n,o),s),i)),a(d(e,l),t)}function i(e,t,n,o,s,l,i){return e=a(e,a(a(function(e,t,n){return e^t^n}(t,n,o),s),i)),a(d(e,l),t)}function r(e,t,n,o,s,l,i){return e=a(e,a(a(function(e,t,n){return t^(e|~n)}(t,n,o),s),i)),a(d(e,l),t)}function c(e){var t,n="",o="";for(t=0;t<=3;t++)n+=(o="0"+(e>>>8*t&255).toString(16)).substr(o.length-2,2);return n}var u={generate:o}})(),MD5=t})(),window.addEventListener("load",onLoad);var wifiJson={},wifiInfo=[];async function loadWifi(){var e,t,n=document.getElementById("wifiName"),o=document.getElementById("wifiSSID"),d=document.getElementById("wifiPassword");document.getElementById("wifiButton").disabled=!0,document.getElementById("wifiPwdCheck").checked=!1,document.getElementById("wifiPassword").type="password",document.getElementById("loader").style.display="block";try{if(!(e=await fetch("CDCWiFi.json")).ok)throw wifiJson={},wifiInfo=[],new Error("Response status: "+e.status);wifiJson=await e.json(),wifiInfo=void 0===wifiJson.wifi||void 0===wifiJson.wifi.length?[]:wifiJson.wifi}catch(e){console.error(e.message)}void 0===wifiJson.hostname&&(wifiJson.hostname="CheapoDC"),wifiJson.hostname!=document.getElementById("hostname").dataset.cdc&&(document.getElementById("wifiMessage").innerHTML="<strong>Important:</strong> Hostname change to "+wifiJson.hostname+" requires reboot to take effect."),void 0===wifiJson.connectAttempts&&(wifiJson.connectAttempts="15"),void 0===wifiJson.tryAPs&&(wifiJson.tryAPs="1");for(let e=n.options.length-1;e>=0;e--)n.remove(e);for(let e=0;e<wifiInfo.length;e++)(t=document.createElement("option")).text=wifiInfo[e].ssid,t.value=e,n.add(t,n[e]);(t=document.createElement("option")).text="Add Wifi",t.value=wifiInfo.length,n.add(t,n[wifiInfo.length]),0==wifiInfo.length?(o.value="",o.placeholder="Enter SSID",d.value="",d.placeholder="Enter Password"):(o.value=wifiInfo[0].ssid,d.value=wifiInfo[0].password),document.getElementById("loader").style.display="none"}function wifiSelectChange(){var e=document.getElementById("wifiName"),t=document.getElementById("wifiSSID"),n=document.getElementById("wifiPassword"),o=e.value;if(document.getElementById("wifiPassword").type="password",document.getElementById("wifiPwdCheck").checked=!1,o==wifiInfo.length)return t.value="",t.placeholder="Enter SSID",n.value="",void(n.placeholder="Enter Password");t.value=wifiInfo[o].ssid,n.value=wifiInfo[o].password}function updateWifi(){let e={...wifiJson};var t=[],n=document.getElementById("wifiName"),o=document.getElementById("wifiSSID"),d=document.getElementById("wifiPassword"),a=n.value;if(document.getElementById("loader").style.display="block",document.getElementById("wifiMessage").innerHTML="<strong>Important:</strong> WiFi changes require reboot to take effect.",a==wifiInfo.length){let e={};e.ssid=o.value,e.password=d.value,wifiInfo.push(e)}else wifiInfo[a].ssid=o.value,wifiInfo[a].password=d.value;for(let e=0;e<wifiInfo.length;e++)""!=wifiInfo[e].ssid&&t.push(wifiInfo[e]);e.wifi=t;var s=new XMLHttpRequest;document.getElementById("loader").style.display="block",s.open("POST","/setwifi",!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.onreadystatechange=function(){4==s.readyState&&200==s.status&&loadWifi()},s.send("wifi="+encodeForHTTP(JSON.stringify(e)))}function showWifiPassword(){var e=document.getElementById("wifiPassword"),t=document.getElementById("wifiName");t.value==t.options.length-1?"password"===e.type?e.type="text":e.type="password":document.getElementById("wifiPwdCheck").checked=!1}function updateHostname(){var e=document.getElementById("hostname").dataset.cdc,t=document.getElementById("hostname").value;let n={...wifiJson};n.hostname=t,document.getElementById("hostname").value=e,document.getElementById("hnButton").disabled=!0,document.getElementById("wifiMessage").innerHTML=t!=e?"<strong>Important:</strong> Hostname change to "+t+" requires reboot to take effect.":"";var o=new XMLHttpRequest;document.getElementById("loader").style.display="block",o.open("POST","/setwifi",!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){4==o.readyState&&200==o.status&&loadWifi()},o.send("wifi="+encodeForHTTP(JSON.stringify(n)))}var fileListCount=0,fileListItem=0;function uploadFile(){const e=document.getElementById("file2").files;fileListCount=e.length,postFileToServer(0)}function postFileToServer(e){if(e<=fileListCount-1){const o=document.getElementById("file2").files;document.getElementById("filename").innerHTML=o[e].name+": ";var t=new FormData;t.append("file2",o[e]);var n=new XMLHttpRequest;n.upload.addEventListener("progress",fProgressHandler,!1),n.addEventListener("load",completeHandler,!1),n.open("POST","/upload"),n.send(t)}else alert("Incorrect file index "+e+" versus max index "+(fileListCount-1))}function fProgressHandler(e){document.getElementById("filesize").innerHTML=e.loaded+" bytes";var t=e.loaded/e.total*100;document.getElementById("status").innerHTML="Completed: "+Math.round(t)+"&percnt;",t>=100&&(document.getElementById("status").innerHTML="Completed: 100%")}function completeHandler(e){if(fileListItem<fileListCount-1)fileListItem+=1,document.getElementById("status").innerHTML="Files Uploaded: "+(fileListItem+1)+" of "+fileListCount,postFileToServer(fileListItem);else{document.getElementById("status").innerHTML="Upload Complete";let e=new XMLHttpRequest;e.onreadystatechange=function(){4==this.readyState&&200==this.status&&(document.getElementById("filelist").innerHTML=e.responseText)},e.open("GET","/filelist",!0),e.send(),document.getElementById("status").innerHTML="Files Uploaded: "+(fileListItem+1),document.getElementById("file2").outerHTML='<input type="file" name="file2" id="file2" multiple/>',document.getElementById("iupload").disabled=!0,document.getElementById("file2").addEventListener("change",function(){document.getElementById("iupload").disabled=!1}),fileListCount=0,fileListItem=0}}function deleteFile(e){if(confirm("Confirm file delete for: "+e)){let t=new XMLHttpRequest;t.onreadystatechange=function(){4==this.readyState&&200==this.status&&(document.getElementById("filelist").innerHTML=t.responseText)},t.open("GET","/delete?file="+e,!0),t.send()}}