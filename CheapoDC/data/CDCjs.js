var MD5,modeCount=0,outstandingQueries=0,refreshCount=0;function onLoad(e){document.getElementById("loader").style.display="block",initButtons(),document.addEventListener("keydown",function(e){e.ctrlKey&&"z"===e.key&&initButtons()})}function convertHTML(e){let t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&apos;":"'","&deg;":"\xb0","&percnt;":"%","&commat;":"@"},n=e,a=e;for(let d in t)a.indexOf(d)>=0&&(a=n=a.replaceAll(d,t[d]));return n}function encodeForHTTP(e){let t={"%":"%25","&":"%26","<":"%3C",">":"%3E","?":"%3F","@":"%40",$:"%24","+":"%2B","#":"%23"},n=e,a=e;for(let d in t)a.indexOf(d)>=0&&(a=n=a.replaceAll(d,t[d]));return n}function removeUnits(e){let t={0:"\xb0",1:"%",2:"min",3:"msec",4:"sec",5:"&"},n=e;for(j=0;j<=5;j++){var a=e.indexOf(t[j]);a>=0&&(n=e.substr(0,a),j=6)}return n}function setValue(e){var t=e.id,n=new XMLHttpRequest;n.open("POST","/getvalue",!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.responseType="json",n.onreadystatechange=()=>{if(n.readyState===XMLHttpRequest.DONE&&200===n.status){var e=n.response,t=Object.keys(e)[0],a=t+"I",d=t+"S",l=Object.values(e)[0];document.getElementById(a)?"number"==document.getElementById(a).type?document.getElementById(a).dataset.cdc=l:document.getElementById(a).dataset.cdc=convertHTML(l):document.getElementById(d)?document.getElementById(d).dataset.cdc=l:console.log("No Input or Select found for: "+t),(refreshCount-=1)<=0&&(refreshCount=0,initButtons())}},n.send("get="+t),refreshCount+=1}function refreshData(){(allcButtons=[...document.getElementsByClassName("cbtn")]).forEach(function(e){setValue(e)})}function sendValue(e){var t,n=e+"I",a=e+"S";if(document.getElementById("loader").style.display="block",document.getElementById(n))t=document.getElementById(n).value;else if(document.getElementById(a))t=document.getElementById(a).value;else{console.log("No Input or Select found for: "+e);return}var d=new XMLHttpRequest;d.open("POST","/setvalue",!0),d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d.responseType="json",d.onreadystatechange=()=>{d.readyState===XMLHttpRequest.DONE&&200===d.status&&refreshData()},d.send(e+"="+encodeForHTTP(t)),document.getElementById(e).disabled=!0}function setChangeItem(e){var t=e.id,n=t+"I",a=t+"S";if(e.disabled=!0,document.getElementById(n)){var d=document.getElementById(n);switch(d.oninput=e=>{document.getElementById(t).disabled=!1,document.getElementById(t).onclick=function(){sendValue(t)}},d.type){case"number":d.value=removeUnits(d.dataset.cdc);break;case"text":case"url":d.value=d.dataset.cdc;break;default:console.log("Bad input type: "+d.type)}}else if(document.getElementById(a)){var d=document.getElementById(a);switch(d.onchange=e=>{document.getElementById(t).disabled=!1,document.getElementById(t).onclick=function(){sendValue(t)}},d.dataset.cdc){case"Automatic":case"Weather Query":case"Dew Point":case"Open-Meteo":case"Disabled":case"0":d.value=0;break;case"Manual":case"External Input":case"Temperature":case"OpenWeather":case"Controller":case"1":d.value=1;break;case"Off":case"Midpoint":case"External Source":case"PWM":d.value=2;break;case"Boolean":d.value=3;break;default:console.log("Bad Select value: "+d.dataset.cdc)}}else{console.log("No Input or Select found for: "+t);return}switch(t){case"DCM":1==document.getElementById("DCMS").value?(document.getElementById("DCO").className="cbtn",document.getElementById("DCOI").disabled=!1):(document.getElementById("DCO").className="cbtn hidden",document.getElementById("DCOI").disabled=!0);break;case"OMIN":var l=parseInt(document.getElementById("OMINI").value);document.getElementById("DCOI").setAttribute("min",l),document.getElementById("OMAXI").setAttribute("min",l+1);break;case"OMAX":var s=parseInt(document.getElementById("OMAXI").value);document.getElementById("DCOI").setAttribute("max",s),document.getElementById("OMINI").setAttribute("max",s-1);break;case"WS":2==document.getElementById("WSS").value?(document.getElementById("ATPQ").className="cbtn",document.getElementById("ATPQI").disabled=!1,document.getElementById("HU").className="cbtn",document.getElementById("HUI").disabled=!1):(document.getElementById("ATPQ").className="cbtn hidden",document.getElementById("ATPQI").disabled=!0,document.getElementById("HU").className="cbtn hidden",document.getElementById("HUI").disabled=!0);break;case"CPP0":case"CPP1":case"CPP2":case"CPP3":case"CPP4":case"CPP5":var o=t.substr(3,1);-1==document.getElementById(n).value?(document.getElementById("CPM"+o).className="cbtn hidden",document.getElementById("CPM"+o+"S").disabled=!0):(document.getElementById("CPM"+o).className="cbtn",document.getElementById("CPM"+o+"S").disabled=!1);break;case"CPM0":case"CPM1":case"CPM2":case"CPM3":case"CPM4":case"CPM5":var o=t.substr(3,1),i=document.getElementById(a).value;switch(i){case"0":case"1":document.getElementById("CPO"+o).className="cbtn hidden",document.getElementById("CPO"+o+"I").disabled=!0;break;case"2":document.getElementById("CPO"+o).className="cbtn",document.getElementById("CPO"+o+"I").disabled=!1,document.getElementById("CPO"+o+"I").setAttribute("step",1);break;case"3":document.getElementById("CPO"+o).className="cbtn",document.getElementById("CPO"+o+"I").disabled=!1,document.getElementById("CPO"+o+"I").setAttribute("step",100)}}}function initButtons(){(allcButtons=[...document.getElementsByClassName("cbtn")]).forEach(function(e){setChangeItem(e)}),document.getElementById("loader").style.display="none"}function logoutCDC(){var e=new XMLHttpRequest;e.open("GET","/logout",!0),e.send(),setTimeout(function(){window.open("/dashboard","_self")},1e3)}function httpOTAAvailability(e){"NOSUPPORT"==e?(document.getElementById("fwUpdateNotAvailable").style.display="block",document.getElementById("fwUpdateNotAvailable").innerHTML="Not supported.",document.getElementById("fwUpdateAvailable").style.display="none"):"NOFWUPDATE"!=e?(document.getElementById("fwUpdateAvailable").style.display="block",document.getElementById("fwUpdateNotAvailable").style.display="none"):(document.getElementById("fwUpdateNotAvailable").style.display="block",document.getElementById("fwUpdateNotAvailable").innerHTML="No update available. Currently at latest version.",document.getElementById("fwUpdateAvailable").style.display="none")}function updateOTAError(e){document.getElementById("otaerror"),console.log("OTA update error: "+e),""==e?document.getElementById("otaerror").style.display="hidden":document.getElementById("otaerror").style.display="block",document.getElementById("otaerror").innerHTML=e}function httpOTAUpload(){var e=MD5.generate("admin:CheapoDC:"+document.getElementById("HTTPOTAPWD").value),t=new XMLHttpRequest,n=new EventSource("/events");window.EventSource?(n.addEventListener("open",e=>{document.getElementById("status").innerHTML="HTTP OTA Connected."}),n.addEventListener("status",e=>{document.getElementById("filename").innerHTML=e.data}),n.addEventListener("error",e=>{e.target.readyState!=EventSource.OPEN?updateOTAError("Events Disconnected"):updateOTAError(e.data)}),n.addEventListener("message",e=>{document.getElementById("status").innerHTML=e.data}),n.addEventListener("progress",e=>{httpOTAProgress(e.data)}),n.addEventListener("reboot",e=>{otaReboot(e.data)})):console.log("something is broken"),t.open("POST","/updatehtml",!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send("password="+encodeForHTTP(e))}function httpOTAProgress(e){e>0?document.getElementById("filesize").innerHTML=" "+e+"&percnt; ":document.getElementById("filesize").innerHTML=" "}function otaReboot(e){"Refresh"==e&&setTimeout(function(){location.reload()},5e3)}function fileOTAUpload(){var e=document.getElementById("file1").files[0];document.getElementById("filename").innerHTML=document.getElementById("file1").value.replace(/.*[\/\\]/,"")+": ";var t=new FormData;t.append("method","file"),t.append("file1",e);var n=new XMLHttpRequest;n.upload.addEventListener("progress",progressHandler,!1),n.open("POST","/update"),n.send(t)}function progressHandler(e){document.getElementById("filesize").innerHTML=e.loaded+" bytes";var t=e.loaded/e.total*100;document.getElementById("status").innerHTML="Completed: "+Math.round(t)+"&percnt;",t>=100&&(document.getElementById("status").innerHTML="Completed: 100&percnt; Wait for Reload.",document.getElementById("iupload").disabled=!0,setTimeout(function(){location.reload()},5e3))}function rebootDevice(){confirm("Confirm Reboot")&&((xmlhttp=new XMLHttpRequest).open("GET","/reboot",!0),xmlhttp.send())}function checkPasswordUpdate(){""!=document.getElementById("newpassword").value&&document.getElementById("newpassword").value==document.getElementById("confpassword").value&&""!=document.getElementById("oldpassword").value?document.getElementById("passwordButton").disabled=!1:document.getElementById("passwordButton").disabled=!0}function changePassword(){var e=MD5.generate("admin:CheapoDC:"+document.getElementById("newpassword").value),t=MD5.generate("admin:CheapoDC:"+document.getElementById("oldpassword").value);if(e!=MD5.generate("admin:CheapoDC:"+document.getElementById("confpassword").value)){alert("New Passwords do not match"),document.getElementById("passwordButton").disabled=!0;return}var n=new XMLHttpRequest;document.getElementById("loader").style.display="block",n.open("POST","/setpassword",!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send("newpassword="+encodeForHTTP(e)+"&oldpassword="+encodeForHTTP(t)),setTimeout(function(){location.reload()},1e3)}(()=>{"use strict";var e={d(t,n){for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{e.r(t),e.d(t,{MD5:()=>c,generate:()=>a});var n=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var a=e.charCodeAt(n);a<128?t+=String.fromCharCode(a):a>127&&a<2048?(t+=String.fromCharCode(a>>6|192),t+=String.fromCharCode(63&a|128)):(t+=String.fromCharCode(a>>12|224),t+=String.fromCharCode(a>>6&63|128),t+=String.fromCharCode(63&a|128))}return t};function a(e){var t,a,d,c,u,m,y,g,_,I;for(t=function(e){for(var t,n=e.length,a=n+8,d=16*((a-a%64)/64+1),l=Array(d-1),s=0,o=0;o<n;)s=o%4*8,l[t=(o-o%4)/4]=l[t]|e.charCodeAt(o)<<s,o++;return s=o%4*8,l[t=(o-o%4)/4]=l[t]|128<<s,l[d-2]=n<<3,l[d-1]=n>>>29,l}(n(e)),y=1732584193,g=4023233417,_=2562383102,I=271733878,a=0;a<t.length;a+=16)d=y,c=g,u=_,m=I,y=s(y,g,_,I,t[a+0],7,3614090360),I=s(I,y,g,_,t[a+1],12,3905402710),_=s(_,I,y,g,t[a+2],17,606105819),g=s(g,_,I,y,t[a+3],22,3250441966),y=s(y,g,_,I,t[a+4],7,4118548399),I=s(I,y,g,_,t[a+5],12,1200080426),_=s(_,I,y,g,t[a+6],17,2821735955),g=s(g,_,I,y,t[a+7],22,4249261313),y=s(y,g,_,I,t[a+8],7,1770035416),I=s(I,y,g,_,t[a+9],12,2336552879),_=s(_,I,y,g,t[a+10],17,4294925233),g=s(g,_,I,y,t[a+11],22,2304563134),y=s(y,g,_,I,t[a+12],7,1804603682),I=s(I,y,g,_,t[a+13],12,4254626195),_=s(_,I,y,g,t[a+14],17,2792965006),y=o(y,g=s(g,_,I,y,t[a+15],22,1236535329),_,I,t[a+1],5,4129170786),I=o(I,y,g,_,t[a+6],9,3225465664),_=o(_,I,y,g,t[a+11],14,643717713),g=o(g,_,I,y,t[a+0],20,3921069994),y=o(y,g,_,I,t[a+5],5,3593408605),I=o(I,y,g,_,t[a+10],9,38016083),_=o(_,I,y,g,t[a+15],14,3634488961),g=o(g,_,I,y,t[a+4],20,3889429448),y=o(y,g,_,I,t[a+9],5,568446438),I=o(I,y,g,_,t[a+14],9,3275163606),_=o(_,I,y,g,t[a+3],14,4107603335),g=o(g,_,I,y,t[a+8],20,1163531501),y=o(y,g,_,I,t[a+13],5,2850285829),I=o(I,y,g,_,t[a+2],9,4243563512),_=o(_,I,y,g,t[a+7],14,1735328473),y=i(y,g=o(g,_,I,y,t[a+12],20,2368359562),_,I,t[a+5],4,4294588738),I=i(I,y,g,_,t[a+8],11,2272392833),_=i(_,I,y,g,t[a+11],16,1839030562),g=i(g,_,I,y,t[a+14],23,4259657740),y=i(y,g,_,I,t[a+1],4,2763975236),I=i(I,y,g,_,t[a+4],11,1272893353),_=i(_,I,y,g,t[a+7],16,4139469664),g=i(g,_,I,y,t[a+10],23,3200236656),y=i(y,g,_,I,t[a+13],4,681279174),I=i(I,y,g,_,t[a+0],11,3936430074),_=i(_,I,y,g,t[a+3],16,3572445317),g=i(g,_,I,y,t[a+6],23,76029189),y=i(y,g,_,I,t[a+9],4,3654602809),I=i(I,y,g,_,t[a+12],11,3873151461),_=i(_,I,y,g,t[a+15],16,530742520),y=r(y,g=i(g,_,I,y,t[a+2],23,3299628645),_,I,t[a+0],6,4096336452),I=r(I,y,g,_,t[a+7],10,1126891415),_=r(_,I,y,g,t[a+14],15,2878612391),g=r(g,_,I,y,t[a+5],21,4237533241),y=r(y,g,_,I,t[a+12],6,1700485571),I=r(I,y,g,_,t[a+3],10,2399980690),_=r(_,I,y,g,t[a+10],15,4293915773),g=r(g,_,I,y,t[a+1],21,2240044497),y=r(y,g,_,I,t[a+8],6,1873313359),I=r(I,y,g,_,t[a+15],10,4264355552),_=r(_,I,y,g,t[a+6],15,2734768916),g=r(g,_,I,y,t[a+13],21,1309151649),y=r(y,g,_,I,t[a+4],6,4149444226),I=r(I,y,g,_,t[a+11],10,3174756917),_=r(_,I,y,g,t[a+2],15,718787259),g=r(g,_,I,y,t[a+9],21,3951481745),y=l(y,d),g=l(g,c),_=l(_,u),I=l(I,m);return f(y)+f(g)+f(_)+f(I)}function d(e,t){return e<<t|e>>>32-t}function l(e,t){var n,a,d,l,s;return d=2147483648&e,l=2147483648&t,s=(1073741823&e)+(1073741823&t),(n=1073741824&e)&(a=1073741824&t)?2147483648^s^d^l:n|a?1073741824&s?3221225472^s^d^l:1073741824^s^d^l:s^d^l}function s(e,t,n,a,s,o,i){var r,f,c;return e=l(e,l(l((r=t,f=n,r&f|~r&(c=a)),s),i)),l(d(e,o),t)}function o(e,t,n,a,s,o,i){var r,f,c;return e=l(e,l(l((r=t,f=n,r&(c=a)|f&~c),s),i)),l(d(e,o),t)}function i(e,t,n,a,s,o,i){var r,f,c;return e=l(e,l(l((r=t,f=n,r^f^(c=a)),s),i)),l(d(e,o),t)}function r(e,t,n,a,s,o,i){var r,f,c;return e=l(e,l(l((r=t,f=n,f^(r|~(c=a))),s),i)),l(d(e,o),t)}function f(e){var t,n="",a="";for(t=0;t<=3;t++)n+=(a="0"+(e>>>8*t&255).toString(16)).substr(a.length-2,2);return n}var c={generate:a}})(),MD5=t})(),window.addEventListener("load",onLoad);var wifiJson={},wifiInfo=[];async function loadWifi(){var e,t,n=document.getElementById("wifiName"),a=document.getElementById("wifiSSID"),d=document.getElementById("wifiPassword");document.getElementById("wifiButton").disabled=!0,document.getElementById("wifiPwdCheck").checked=!1,document.getElementById("wifiPassword").type="password",document.getElementById("loader").style.display="block";try{if((e=await fetch("CDCWiFi.json")).ok)wifiJson=await e.json(),wifiInfo=void 0===wifiJson.wifi?[]:wifiJson.wifi,void 0!==wifiJson.hostname&&wifiJson.hostname!=document.getElementById("hostname").dataset.cdc&&(document.getElementById("wifiMessage").innerHTML="<strong>Important:</strong> Hostname change to "+wifiJson.hostname+" requires reboot to take effect.");else throw Error(`Response status: ${e.status}`)}catch(l){console.error(l.message)}for(var s=n.options.length-1;s>=0;s--)n.remove(s);for(var s=0;s<wifiInfo.length;s++)(t=document.createElement("option")).text=wifiInfo[s].ssid,t.value=s,n.add(t,n[s]);(t=document.createElement("option")).text="Add Wifi",t.value=wifiInfo.length,n.add(t,n[wifiInfo.length]),0==wifiInfo.length?(a.value="",a.placeholder="Enter SSID",d.value="",d.placeholder="Enter Password"):(a.value=wifiInfo[0].ssid,d.value=wifiInfo[0].password),document.getElementById("loader").style.display="none"}function wifiSelectChange(){var e=document.getElementById("wifiName"),t=document.getElementById("wifiSSID"),n=document.getElementById("wifiPassword"),a=e.value;if(document.getElementById("wifiPassword").type="password",document.getElementById("wifiPwdCheck").checked=!1,a==wifiInfo.length){t.value="",t.placeholder="Enter SSID",n.value="",n.placeholder="Enter Password";return}t.value=wifiInfo[a].ssid,n.value=wifiInfo[a].password}function updateWifi(){let e={...wifiJson};var t=document.getElementById("wifiName"),n=document.getElementById("wifiSSID"),a=document.getElementById("wifiPassword"),d=t.value;if(document.getElementById("loader").style.display="block",document.getElementById("wifiMessage").innerHTML="<strong>Important:</strong> WiFi changes require reboot to take effect.",d==wifiInfo.length){var l={};l.ssid=n.value,l.password=a.value,wifiInfo.push(l)}else wifiInfo[d].ssid=n.value,wifiInfo[d].password=a.value;for(var s=[],o=0;o<wifiInfo.length;o++)""!=wifiInfo[o].ssid&&s.push(wifiInfo[o]);e.wifi=s;var i=new XMLHttpRequest;document.getElementById("loader").style.display="block",i.open("POST","/setwifi",!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){4==i.readyState&&200==i.status&&loadWifi()},i.send("wifi="+encodeForHTTP(JSON.stringify(e)))}function showWifiPassword(){var e=document.getElementById("wifiPassword"),t=document.getElementById("wifiName");t.value==t.options.length-1?"password"===e.type?e.type="text":e.type="password":document.getElementById("wifiPwdCheck").checked=!1}function updateHostname(){var e=document.getElementById("hostname").dataset.cdc,t=document.getElementById("hostname").value;let n={...wifiJson};n.hostname=t,document.getElementById("hostname").value=e,document.getElementById("hnButton").disabled=!0,t!=e?document.getElementById("wifiMessage").innerHTML="<strong>Important:</strong> Hostname change to "+t+" requires reboot to take effect.":document.getElementById("wifiMessage").innerHTML="";var a=new XMLHttpRequest;document.getElementById("loader").style.display="block",a.open("POST","/setwifi",!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){4==a.readyState&&200==a.status&&loadWifi()},a.send("wifi="+encodeForHTTP(JSON.stringify(n)))}var fileListCount=0,fileListItem=0;function uploadFile(){let e=document.getElementById("file2").files;fileListCount=e.length,postFileToServer(0)}function postFileToServer(e){if(e<=fileListCount-1){let t=document.getElementById("file2").files;document.getElementById("filename").innerHTML=t[e].name+": ";var n=new FormData;n.append("file2",t[e]);var a=new XMLHttpRequest;a.upload.addEventListener("progress",fProgressHandler,!1),a.addEventListener("load",completeHandler,!1),a.open("POST","/upload"),a.send(n)}else alert("Incorrect file index "+e+" versus max index "+(fileListCount-1))}function fProgressHandler(e){document.getElementById("filesize").innerHTML=e.loaded+" bytes";var t=e.loaded/e.total*100;document.getElementById("status").innerHTML="Completed: "+Math.round(t)+"&percnt;",t>=100&&(document.getElementById("status").innerHTML="Completed: 100%")}function completeHandler(e){fileListItem<fileListCount-1?(fileListItem+=1,document.getElementById("status").innerHTML="Files Uploaded: "+(fileListItem+1)+" of "+fileListCount,postFileToServer(fileListItem)):(document.getElementById("status").innerHTML="Upload Complete",(xmlhttp=new XMLHttpRequest).onreadystatechange=function(){4==this.readyState&&200==this.status&&(document.getElementById("filelist").innerHTML=xmlhttp.responseText)},xmlhttp.open("GET","/filelist",!0),xmlhttp.send(),document.getElementById("status").innerHTML="Files Uploaded: "+(fileListItem+1),document.getElementById("file2").outerHTML='<input type="file" name="file2" id="file2" multiple/>',document.getElementById("iupload").disabled=!0,document.getElementById("file2").addEventListener("change",function(){document.getElementById("iupload").disabled=!1}),fileListCount=0,fileListItem=0)}function deleteFile(e){confirm("Confirm file delete for: "+e)&&((xmlhttp=new XMLHttpRequest).onreadystatechange=function(){4==this.readyState&&200==this.status&&(document.getElementById("filelist").innerHTML=xmlhttp.responseText)},xmlhttp.open("GET","/delete?file="+e,!0),xmlhttp.send())}