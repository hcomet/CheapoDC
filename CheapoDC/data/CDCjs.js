var modeCount=0,outstandingQueries=0,refreshCount=0;function onLoad(e){document.getElementById("loader").style.display="block",initButtons(),document.addEventListener("keydown",function(e){e.ctrlKey&&"z"===e.key&&initButtons()})}function convertHTML(e){let t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&apos;":"'","&deg;":"\xb0","&percnt;":"%","&commat;":"@"},n=e,a=e;for(let s in t)a.indexOf(s)>=0&&(a=n=a.replaceAll(s,t[s]));return n}function encodeForHTTP(e){let t={"%":"%25","&":"%26","<":"%30",">":"%3E","?":"%3F","@":"%40",$:"%24","#":"%23"},n=e,a=e;for(let s in t)a.indexOf(s)>=0&&(a=n=a.replaceAll(s,t[s]));return n}function removeUnits(e){let t={0:"\xb0",1:"%",2:"min",3:"msec",4:"sec",5:"&"},n=e;for(j=0;j<=5;j++){var a=e.indexOf(t[j]);a>=0&&(n=e.substr(0,a),j=6)}return n}function setValue(e){var t=e.id,n=new XMLHttpRequest;n.open("POST","/getvalue",!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.responseType="json",n.onreadystatechange=()=>{if(n.readyState===XMLHttpRequest.DONE&&200===n.status){var e=n.response,t=Object.keys(e)[0],a=t+"I",s=t+"S",l=Object.values(e)[0];document.getElementById(a)?"number"==document.getElementById(a).type?document.getElementById(a).dataset.cdc=l:document.getElementById(a).dataset.cdc=convertHTML(l):document.getElementById(s)?document.getElementById(s).dataset.cdc=l:console.log("No Input or Select found for: "+t),(refreshCount-=1)<=0&&(refreshCount=0,initButtons())}},n.send("get="+t),refreshCount+=1}function refreshData(){(allcButtons=[...document.getElementsByClassName("cButton")]).forEach(function(e){setValue(e)})}function sendValue(e){var t,n=e+"I",a=e+"S";if(document.getElementById("loader").style.display="block",document.getElementById(n))t=document.getElementById(n).value;else if(document.getElementById(a))t=document.getElementById(a).value;else{console.log("No Input or Select found for: "+e);return}var s=new XMLHttpRequest;s.open("POST","/setvalue",!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.responseType="json",s.onreadystatechange=()=>{s.readyState===XMLHttpRequest.DONE&&200===s.status&&refreshData()},s.send(e+"="+encodeForHTTP(t)),document.getElementById(e).disabled=!0}function setChangeItem(e){var t=e.id,n=t+"I",a=t+"S";if(e.disabled=!0,document.getElementById(n)){var s=document.getElementById(n);switch(s.oninput=e=>{document.getElementById(t).disabled=!1,document.getElementById(t).onclick=function(){sendValue(t)}},s.type){case"number":s.value=removeUnits(s.dataset.cdc);break;case"text":case"url":s.value=s.dataset.cdc;break;default:console.log("Bad input type: "+s.type)}}else if(document.getElementById(a)){var s=document.getElementById(a);switch(s.onchange=e=>{document.getElementById(t).disabled=!1,document.getElementById(t).onclick=function(){sendValue(t)}},s.dataset.cdc){case"Automatic":case"Weather Query":case"Dew Point":case"Open-Meteo":case"Disabled":s.value=0;break;case"Manual":case"External Input":case"Temperature":case"OpenWeather":case"Controller":s.value=1;break;case"Off":case"Midpoint":case"External Source":case"PWM":s.value=2;break;case"Boolean":s.value=3;break;default:console.log("Bad Select value: "+s.dataset.cdc)}}else{console.log("No Input or Select found for: "+t);return}switch(t){case"DCM":1==document.getElementById("DCMS").value?(document.getElementById("DCO").className="cButton",document.getElementById("DCOI").disabled=!1):(document.getElementById("DCO").className="cButton hidden",document.getElementById("DCOI").disabled=!0);break;case"OMIN":var l=parseInt(document.getElementById("OMINI").value);document.getElementById("DCOI").setAttribute("min",l),document.getElementById("OMAXI").setAttribute("min",l+1);break;case"OMAX":var d=parseInt(document.getElementById("OMAXI").value);document.getElementById("DCOI").setAttribute("max",d),document.getElementById("OMINI").setAttribute("max",d-1);break;case"WS":2==document.getElementById("WSS").value?(document.getElementById("ATPQ").className="cButton",document.getElementById("ATPQI").disabled=!1,document.getElementById("HU").className="cButton",document.getElementById("HUI").disabled=!1):(document.getElementById("ATPQ").className="cButton hidden",document.getElementById("ATPQI").disabled=!0,document.getElementById("HU").className="cButton hidden",document.getElementById("HUI").disabled=!0);break;case"CPP0":case"CPP1":case"CPP2":case"CPP3":case"CPP4":case"CPP5":var c=t.substr(3,1);-1==document.getElementById(n).value?(document.getElementById("CPM"+c).className="cButton hidden",document.getElementById("CPM"+c+"S").disabled=!0):(document.getElementById("CPM"+c).className="cButton",document.getElementById("CPM"+c+"S").disabled=!1);break;case"CPM0":case"CPM1":case"CPM2":case"CPM3":case"CPM4":case"CPM5":var c=t.substr(3,1),o=document.getElementById(a).value;switch(o){case"0":case"1":document.getElementById("CPO"+c).className="cButton hidden",document.getElementById("CPO"+c+"I").disabled=!0;break;case"2":document.getElementById("CPO"+c).className="cButton",document.getElementById("CPO"+c+"I").disabled=!1,document.getElementById("CPO"+c+"I").setAttribute("step",1);break;case"3":document.getElementById("CPO"+c).className="cButton",document.getElementById("CPO"+c+"I").disabled=!1,document.getElementById("CPO"+c+"I").setAttribute("step",100)}}}function initButtons(){(allcButtons=[...document.getElementsByClassName("cButton")]).forEach(function(e){setChangeItem(e)}),document.getElementById("loader").style.display="none"}function logoutCDC(){var e=new XMLHttpRequest;e.open("GET","/logout",!0),e.send(),setTimeout(function(){window.open("/dashboard","_self")},1e3)}window.addEventListener("load",onLoad);